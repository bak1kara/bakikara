<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yönetici Paneli | BAKİ S2 - İŞLEVCİL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --purple: #6c5ce7; }
        body { 
            font-family: 'Poppins', sans-serif; 
            background-color: #110915; 
            color: #ffffff;
            min-height: 100vh;
            display: flex; 
        }
        .sidebar {
            background-color: #1a0e21; 
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.4);
            flex-shrink: 0;
            width: 250px;
        }
        .main-content {
            background-color: #110915;
            flex-grow: 1;
            padding: 2.5rem;
        }
        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            margin: 0.25rem 0;
            border-radius: 0.5rem;
            color: #ccc;
            transition: all 0.3s;
        }
        .nav-link:hover, .nav-link.active {
            background-color: rgba(108, 92, 231, 0.1); /* purple-100 equivalent */
            color: #ffffff;
            border-left: 4px solid var(--purple);
            padding-left: calc(1rem - 4px); /* Kenarlık kalınlığını dengele */
        }
        .card {
            background-color: #1a0e21;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        .admin-button {
            background-color: var(--purple);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        .admin-button:hover {
            background-color: #5d4aeb; 
        }
        /* Custom scrollbar for a dark theme */
        .overflow-y-auto::-webkit-scrollbar { width: 8px; }
        .overflow-y-auto::-webkit-scrollbar-thumb { 
            background-color: #3b2a4d; 
            border-radius: 4px;
        }
        .overflow-y-auto::-webkit-scrollbar-track { 
            background: #110915; 
        }
    </style>
</head>
<body>

    <!-- Yan Menü (Sidebar) -->
    <aside class="sidebar h-screen flex flex-col items-center p-6 space-y-8">
        <div class="text-3xl font-extrabold text-white">
            <span class="text-purple-400">BAKİ</span> S2
        </div>
        <nav class="flex flex-col w-full space-y-1 overflow-y-auto">
            <a href="#" class="nav-link active" data-content="dashboard">
                <i class="fas fa-home mr-3 text-lg"></i> Yönetim Panosu
            </a>
            <a href="#" class="nav-link" data-content="analytics">
                <i class="fas fa-chart-line mr-3 text-lg"></i> Sistem Analizleri
            </a>
            <a href="#" class="nav-link" data-content="network">
                <i class="fas fa-globe mr-3 text-lg"></i> Ağ Aktivitesi
            </a>
            <a href="#" class="nav-link" data-content="users">
                <i class="fas fa-users mr-3 text-lg"></i> Kullanıcı Yönetimi
            </a>
            <a href="#" class="nav-link" data-content="links">
                <i class="fas fa-link mr-3 text-lg"></i> Link Yönetimi
            </a>
            <a href="#" class="nav-link" data-content="reports">
                <i class="fas fa-file-alt mr-3 text-lg"></i> Rapor Yönetimi
            </a>
            <a href="#" class="nav-link" data-content="settings">
                <i class="fas fa-cog mr-3 text-lg"></i> Sistem Ayarları
            </a>
        </nav>
        <button id="adminLogoutButton" class="admin-button w-full mt-auto flex items-center justify-center space-x-2 hidden">
            <i class="fas fa-sign-out-alt"></i>
            <span>Çıkış Yap</span>
        </button>
    </aside>

    <!-- Ana İçerik -->
    <main class="main-content flex flex-col">
        <header class="mb-8 flex justify-between items-center">
            <h1 id="pageTitle" class="text-4xl font-extrabold text-white">Yönetim Panosu</h1>
            <div id="userInfo" class="flex items-center space-x-3 bg-gray-800 p-2 rounded-lg text-sm">
                <i class="fas fa-user-shield text-purple-400"></i>
                <span id="currentUserIdText" class="font-medium text-gray-300">Auth Hazırlanıyor...</span>
            </div>
        </header>

        <!-- İçerik Alanları -->
        <div id="contentContainer" class="flex-grow">
            <!-- DASHBOARD Content -->
            <div id="dashboard" class="content-area grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Metrik Kartları -->
                <div class="card lg:col-span-1">
                    <h3 class="text-xl font-semibold text-purple-400 mb-4">Genel Metrikler</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center border-b border-gray-700 pb-2">
                            <span>Aktif Kullanıcılar</span>
                            <span class="font-bold text-2xl" id="metricActiveUsers">0</span>
                        </div>
                        <div class="flex justify-between items-center border-b border-gray-700 pb-2">
                            <span>Toplam Link Sayısı</span>
                            <span class="font-bold text-2xl" id="metricTotalLinks">0</span>
                        </div>
                        <div class="flex justify-between items-center pb-2">
                            <span>Son 24 Saat Trafik</span>
                            <span class="font-bold text-2xl" id="metricDailyTraffic">0</span>
                        </div>
                    </div>
                </div>

                <!-- Son İşlemler (Placeholder) -->
                <div class="card lg:col-span-2">
                    <h3 class="text-xl font-semibold text-purple-400 mb-4">Son İşlemler</h3>
                    <ul class="space-y-2 text-sm text-gray-400" id="latestActivitiesList">
                        <li><i class="fas fa-check-circle mr-2 text-green-500"></i> 1 dakika önce: Yeni link oluşturuldu.</li>
                        <li><i class="fas fa-user-plus mr-2 text-blue-400"></i> 5 dakika önce: Yeni yönetici (user-123) giriş yaptı.</li>
                        <li><i class="fas fa-exclamation-triangle mr-2 text-yellow-500"></i> 15 dakika önce: Rapor (Link-456) incelenmeye alındı.</li>
                    </ul>
                </div>

                <!-- Sistem Sağlığı -->
                <div class="card lg:col-span-3">
                    <h3 class="text-xl font-semibold text-purple-400 mb-4">Sistem Sağlığı Durumu</h3>
                    <div class="flex items-center space-x-4">
                        <span class="text-green-500 font-bold text-lg"><i class="fas fa-heartbeat mr-2"></i>Tüm Servisler Aktif</span>
                        <span class="text-gray-500">|</span>
                        <span class="text-sm">Son Kontrol: <span id="lastCheckTime">Şimdi</span></span>
                    </div>
                </div>
            </div>

            <!-- ANALYTICS Content -->
            <div id="analytics" class="content-area hidden">
                <div class="card mb-6">
                    <h3 class="text-xl font-semibold text-purple-400 mb-4">Trafik Dağılım Grafiği (Son 7 Gün)</h3>
                    <canvas id="trafficChart" height="150"></canvas>
                </div>
            </div>

            <!-- LINKS Content (Placeholder for filterLinksButton) -->
            <div id="links" class="content-area hidden">
                <div class="card mb-6 flex justify-end">
                    <!-- filterLinksButton referansı için bir buton ekliyoruz -->
                    <button id="filterLinksButton" class="admin-button bg-blue-600 hover:bg-blue-700">Linkleri Filtrele (Placeholder)</button>
                </div>
                <div class="card">
                    <h3 class="text-xl font-semibold text-purple-400 mb-4">Tüm Linkler</h3>
                    <p class="text-gray-400">Link yönetim tablosu buraya gelecek.</p>
                </div>
            </div>
            
            <!-- Diğer İçerikler (network, users, reports, settings) - Gizli -->
            <div id="network" class="content-area hidden"><div class="card">Ağ Aktivitesi İçeriği</div></div>
            <div id="users" class="content-area hidden"><div class="card">Kullanıcı Yönetimi İçeriği</div></div>
            <div id="reports" class="content-area hidden"><div class="card">Rapor Yönetimi İçeriği</div></div>
            <div id="settings" class="content-area hidden"><div class="card">Sistem Ayarları İçeriği</div></div>

        </div>
    </main>

    <script type="module">
        // ====================================================================
        // 1. FIREBASE İMPORTLARI VE YAPILANDIRMASI (Kullanıcının isteği eklendi)
        // ====================================================================
        
        // Canvas Ortamı Zorunlu Global Değişkenler
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfigString = typeof __firebase_config !== 'undefined' ? __firebase_config : null;

        // Kullanıcının sağladığı yapılandırma (Global değişken yoksa bu kullanılır)
        const userProvidedConfig = {
            apiKey: "AIzaSyBfc0F8o5aVmwTw-gyLRVVI2OMUljFi6Ao",
            authDomain: "baki-s2-yonetim.firebaseapp.com",
            projectId: "baki-s2-yonetim",
            storageBucket: "baki-s2-yonetim.firebasestorage.app",
            messagingSenderId: "692508919425",
            appId: "1:692508919425:web:fac963c81c11b7be70af80",
            measurementId: "G-Q52XG8GLB2"
        };

        const firebaseConfig = firebaseConfigString ? JSON.parse(firebaseConfigString) : userProvidedConfig;
        
        // Firebase Modül Yüklemeleri
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, setLogLevel, doc, onSnapshot, collection 
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        setLogLevel('Debug'); // Konsol loglarını etkinleştir

        // Firebase Servislerini Başlatma
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        let userId = null;

        // Oturum Açma İşlemi (Zorunlu)
        const setupAuth = async () => {
            try {
                const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Firebase Kimlik Doğrulama Hatası:", error);
            }
        };

        // Oturum Kapatma İşlemi
        const handleLogout = async () => {
            try {
                await signOut(auth);
                // Çıkış yapıldıktan sonra arayüzü güncelle
                document.getElementById('currentUserIdText').textContent = 'Oturum Kapalı';
                document.getElementById('adminLogoutButton').style.display = 'none';
            } catch (error) {
                console.error("Çıkış Hatası:", error);
            }
        };

        document.getElementById('adminLogoutButton').addEventListener('click', handleLogout);

        // ====================================================================
        // 2. TEMEL UYGULAMA MANTIĞI VE UI FONKSİYONLARI
        // ====================================================================

        // Placeholder Fonksiyonlar (Gerçek Firestore bağlantısı burada kurulmalıdır)
        const loadDashboardData = () => {
            console.log("Dashboard verileri yükleniyor... Firestore/Analiz bağlantısı bekleniyor.");
            document.getElementById('metricActiveUsers').textContent = '42';
            document.getElementById('metricTotalLinks').textContent = '1024';
            document.getElementById('metricDailyTraffic').textContent = '87K';
            document.getElementById('lastCheckTime').textContent = new Date().toLocaleTimeString('tr-TR');

            // Firestore Snapshot örneği (Sadece kullanıcı kimliği varsa dinlenir)
            if(userId) {
                const userDocRef = doc(db, 'artifacts', appId, 'users', userId, 'dashboard', 'metrics');
                // Sadece gösterim amaçlı bir onSnapshot örneği
                onSnapshot(userDocRef, (doc) => {
                    if (doc.exists()) {
                        console.log("Firestore verisi alındı:", doc.data());
                    }
                }, (error) => {
                    console.error("Firestore Snapshot Hatası:", error);
                });
            }
        };

        const drawAnalyticsCharts = () => {
             const ctx = document.getElementById('trafficChart').getContext('2d');
             new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Pzt', 'Sal', 'Çar', 'Per', 'Cum', 'Cmt', 'Paz'],
                    datasets: [{
                        label: 'Günlük Ziyaretçi Sayısı',
                        data: [1200, 1900, 3000, 5000, 2000, 3000, 4500],
                        borderColor: '#6c5ce7',
                        backgroundColor: 'rgba(108, 92, 231, 0.2)',
                        tension: 0.3,
                        fill: true,
                        pointRadius: 4,
                        pointBackgroundColor: '#6c5ce7',
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#2a1a31' } },
                        x: { grid: { display: false } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        };

        // Sekme Değiştirme Fonksiyonu
        const pageTitle = document.getElementById('pageTitle');
        const navItems = document.querySelectorAll('.sidebar .nav-link');
        const contentAreas = document.querySelectorAll('.content-area');
        const filterLinksButton = document.getElementById('filterLinksButton'); // Referans olarak tanımlandı

        const switchTab = (targetContentId) => {
            contentAreas.forEach(area => area.classList.add('hidden'));
            document.getElementById(targetContentId).classList.remove('hidden');
            
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-content') === targetContentId) {
                    item.classList.add('active');
                }
            });
            
            const titleMap = {
                'dashboard': 'Yönetim Panosu', 'analytics': 'Sistem Analizleri', 'network': 'Ağ Aktivitesi',
                'users': 'Kullanıcı Yönetimi', 'links': 'Link Yönetimi', 'reports': 'Rapor Yönetimi',
                'settings': 'Sistem Ayarları'
            };
            pageTitle.textContent = titleMap[targetContentId] || 'Yönetim Paneli';

            if (targetContentId === 'analytics') {
                drawAnalyticsCharts();
            }
            if (targetContentId === 'links') {
                 // Placeholder butonuna tıklama simülasyonu
                 // filterLinksButton.click(); 
            }
        };

        // Menü Bağlantılarına Click Listener Ekleme
        navItems.forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                switchTab(item.getAttribute('data-content'));
            });
        });

        // ====================================================================
        // 3. BAŞLATMA
        // ====================================================================
        document.addEventListener('DOMContentLoaded', () => {
            // 1. Firebase Auth'u Başlat
            setupAuth(); 

            // 2. Auth Durumu Değiştiğinde
            onAuthStateChanged(auth, (user) => {
                if (user) {
                   userId = user.uid; // Kullanıcı kimliğini ayarla
                   document.getElementById('currentUserIdText').textContent = `ID: ${userId}`;
                   document.getElementById('adminLogoutButton').style.display = 'flex';
                   
                   // Yükleme sadece kimlik doğrulama başarılı ise yapılır
                   loadDashboardData(); 

                } else {
                   // Oturum yoksa (Anonim giriş bile başarısızsa), çıkış butonunu gizle ve durumu belirt
                   userId = crypto.randomUUID(); // Anonim kullanıcılar için rastgele ID
                   document.getElementById('currentUserIdText').textContent = 'Oturum Açılmadı (Anonim ID)';
                   document.getElementById('adminLogoutButton').style.display = 'none';
                }
            });
           
            // İlk sekmeyi aç
            switchTab('dashboard'); 
        });

    </script>
</body>
</html>
