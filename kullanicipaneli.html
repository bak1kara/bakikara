<body class="min-h-screen">
    
    <script type="module" src="https://www.gstatic.com/firebase/9.6.1/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebase/9.6.1/firebase-auth.js"></script>
    <script type="module" src="https://www.gstatic.com/firebase/9.6.1/firebase-firestore.js"></script>

    <script type="module" src="./firebase-auth-service.js"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebase/9.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebase/9.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection, query, where, getDocs } from "https://www.gstatic.com/firebase/9.6.1/firebase-firestore.js";
        
        // ... (Firebase config ve initializeApp kısmı) ... 
        const firebaseConfig = {
            // Buraya gerçek Firebase yapılandırmanızı yapıştırın
            apiKey: "AIzaSyBfc0F8o5aVmwTw-gyLRZVI2OMUljFi6Ao",
            authDomain: "baki-s2-yonetim.firebaseapp.com",
            projectId: "baki-s2-yonetim",
            storageBucket: "baki-s2-yonetim.firebasestorage.app",
            messagingSenderId: "692508919425",
            appId: "1:692508919425:web:fac963c81c11b7be70af80",
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);


        // --- Güvenlik ve Oturum Kontrolü (ANA DEĞİŞİKLİK) ---
        onAuthStateChanged(auth, (user) => {
            const loadingOverlay = document.getElementById('loadingOverlay');
            const mainContentWrapper = document.getElementById('mainContentWrapper');

            if (user && user.isAnonymous === false) {
                // Kullanıcı Giriş Yapmışsa:
                loadingOverlay.classList.add('hidden');
                mainContentWrapper.classList.remove('hidden');
                
                // Firestore verilerini çekme fonksiyonunu çağır
                fetchUserData(user); 
                
            } else {
                // Kullanıcı Giriş Yapmamış veya Anonimse:
                // Güvenlik: Giriş sayfasına yönlendir.
                console.log("Yetkisiz erişim denemesi. Giriş sayfasına yönlendiriliyor.");
                window.location.href = 'girisyap.html'; 
            }
        });
        
        // --- Çıkış Yap Butonu Olayı ---
        document.getElementById('logoutButton').addEventListener('click', () => {
            signOut(auth).then(() => {
                // Çıkış başarılı
                window.location.href = 'girisyap.html';
            }).catch((error) => {
                console.error("Çıkış hatası:", error);
                alert("Çıkış işlemi sırasında bir hata oluştu.");
            });
        });
        
        // ... (fetchUserData, saveProfile, switchTab, linkModal fonksiyonları buraya eklenecek/korunacak) ...

        // Sayfa yüklendiğinde Firebase'i başlat
        // NOT: initializeFirebase kaldırıldı, onAuthStateChanged direkt çağırılıyor.
        // window.onload = initializeFirebase; 
    </script>
</body>
</html>
